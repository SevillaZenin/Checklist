<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checklist de tareas</title>
  <style>
    :root{
      --bg:#0b1220; --card:#121b2f; --muted:#93a4c7; --text:#eaf0ff;
      --accent:#5eead4; --danger:#fb7185; --border:rgba(255,255,255,.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
      background: radial-gradient(1200px 600px at 20% 0%, rgba(94,234,212,.15), transparent 60%),
                  radial-gradient(900px 500px at 90% 10%, rgba(251,113,133,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{max-width:980px; margin:24px auto; padding:0 14px}
    .top{
      display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end; justify-content:space-between;
      margin-bottom:14px;
    }
    h1{font-size:20px; margin:0}
    .sub{color:var(--muted); font-size:13px; margin-top:6px}
    .grid{display:grid; grid-template-columns: 1fr; gap:12px}
    @media (min-width: 920px){ .grid{grid-template-columns: 420px 1fr;} }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px;
      box-shadow: 0 12px 30px rgba(0,0,0,.25);
    }
    textarea{
      width:100%; min-height:260px; resize:vertical;
      background:rgba(0,0,0,.25);
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      color:var(--text);
      outline:none;
      font-size:13px;
      line-height:1.35;
    }
    textarea:focus{border-color: rgba(94,234,212,.35)}
    .row{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    button{
      border:1px solid var(--border);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      font-size:13px;
    }
    button:hover{border-color: rgba(255,255,255,.18)}
    button.primary{
      background: rgba(94,234,212,.14);
      border-color: rgba(94,234,212,.25);
    }
    button.danger{
      background: rgba(251,113,133,.12);
      border-color: rgba(251,113,133,.22);
    }
    .toolbar{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-bottom:10px;
    }
    .pill{
      padding:6px 10px; border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.05);
      font-size:12px; color:var(--muted);
      display:inline-flex; gap:8px; align-items:center;
    }
    .pill b{color:var(--text)}
    .search{
      width:240px; max-width:100%;
      padding:10px 12px; border-radius:12px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.22);
      color:var(--text);
      outline:none;
      font-size:13px;
    }
    .list{display:flex; flex-direction:column; gap:10px}
    .section{
      border:1px solid var(--border);
      background:rgba(0,0,0,.18);
      border-radius:14px;
      overflow:hidden;
    }
    .sectionHeader{
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      padding:10px 12px;
      background:rgba(255,255,255,.03);
      border-bottom:1px solid var(--border);
    }
    .sectionTitle{font-weight:800; font-size:13px}
    .items{padding:10px 12px; display:flex; flex-direction:column; gap:8px}
    label.item{
      display:flex; gap:10px; align-items:flex-start;
      padding:10px 10px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      border-radius:12px;
    }
    input[type="checkbox"]{transform: translateY(2px) scale(1.15); accent-color: var(--accent)}
    .meta{font-size:12px; color:var(--muted); margin-top:2px}
    .done .text{opacity:.55; text-decoration:line-through}
    .dateTag{
      font-size:11px; padding:2px 8px; border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--muted);
      white-space:nowrap;
    }
    .footerNote{font-size:12px; color:var(--muted); margin-top:10px}
    .small{font-size:12px; color:var(--muted)}
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size:11px; padding:2px 6px; border-radius:8px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--muted);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>Checklist de tareas</h1>
        <div class="sub">Pega cualquier lista, genera checks y ve marcando lo que ya entregaste. Se guarda automático en este navegador.</div>
      </div>
      <div class="small">Tip: <span class="kbd">Ctrl</span> + <span class="kbd">F</span> también ayuda a buscar rápido.</div>
    </div>

    <div class="grid">
      <!-- LEFT: Input -->
      <div class="card">
        <div style="font-weight:800; margin-bottom:8px;">Pega tu lista aquí</div>
        <textarea id="rawInput" spellcheck="false"></textarea>

        <div class="row">
          <button class="primary" id="btnGenerate">Generar lista</button>
          <button id="btnLoadExample">Cargar tu ejemplo</button>
          <button class="danger" id="btnResetAll">Borrar TODO (lista + progreso)</button>
        </div>

        <div class="footerNote">
          <b>Formato recomendado:</b><br>
          - Títulos (materias) como línea normal o numerada<br>
          - Tareas con guion <b>-</b> o viñeta<br><br>
          <b>Atajos:</b> Marca/desmarca y se guarda solo.
        </div>
      </div>

      <!-- RIGHT: Checklist -->
      <div class="card">
        <div class="toolbar">
          <div class="pill"><span>Progreso:</span> <b id="progressTxt">0/0</b></div>
          <input class="search" id="search" placeholder="Buscar (materia o tarea)..." />
          <div class="row" style="margin:0">
            <button id="btnUncheckAll">Desmarcar todo</button>
            <button id="btnExport">Exportar</button>
            <button id="btnImport">Importar</button>
          </div>
        </div>

        <div id="list" class="list"></div>
        <div class="footerNote">
          <b>Exportar/Importar</b> te sirve si cambias de PC o navegador.
        </div>
      </div>
    </div>
  </div>

<script>
/**
 * Checklist builder (1-file).
 * - Parse text into sections and items.
 * - Persist data + checkbox states in localStorage.
 * - Search filter.
 */

const LS_KEY = "checklist_app_v1";

const els = {
  rawInput: document.getElementById("rawInput"),
  btnGenerate: document.getElementById("btnGenerate"),
  btnLoadExample: document.getElementById("btnLoadExample"),
  btnResetAll: document.getElementById("btnResetAll"),
  list: document.getElementById("list"),
  progressTxt: document.getElementById("progressTxt"),
  search: document.getElementById("search"),
  btnUncheckAll: document.getElementById("btnUncheckAll"),
  btnExport: document.getElementById("btnExport"),
  btnImport: document.getElementById("btnImport"),
};

let state = {
  raw: "",
  sections: [], // {id, title, items:[{id, text, due, done}]}
};

function uid(prefix="id"){
  return prefix + "_" + Math.random().toString(16).slice(2) + Date.now().toString(16);
}

function save(){
  localStorage.setItem(LS_KEY, JSON.stringify(state));
}

function load(){
  const s = localStorage.getItem(LS_KEY);
  if(!s) return false;
  try{
    state = JSON.parse(s);
    if(!state || !Array.isArray(state.sections)) return false;
    return true;
  }catch(e){
    return false;
  }
}

function normalizeLine(line){
  return line.replace(/\t/g, " ").replace(/\s+/g, " ").trim();
}

// Extract due date inside parentheses e.g. "(09 febrero)" or "(11 de febrero)"
function extractDue(text){
  const m = text.match(/\(([^)]+)\)/);
  if(!m) return {clean: text.trim(), due: ""};
  const due = m[1].trim();
  const clean = text.replace(m[0], "").replace(/\s+/g," ").trim();
  return {clean, due};
}

function isTaskLine(line){
  return /^[-•–]\s*/.test(line);
}


function stripBullet(line){
  return line.replace(/^[-•–]\s+/, "").trim();
}

function isSectionLine(line){
  // e.g. "1. INTELIGENCIA ARTIFICIAL", "INTELIGENCIA ARTIFICIAL"
  // We treat lines that are NOT task lines, and have letters/numbers
  if(!line) return false;
  if(isTaskLine(line)) return false;
  // avoid generic "Tarea" alone -> considered header too
  return /[A-Za-zÁÉÍÓÚÜÑ0-9]/.test(line);
}

function parseToSections(raw){
  const lines = raw.split("\n").map(normalizeLine).filter(l => l.length > 0);

  const sections = [];
  let current = null;

  for(const line of lines){
    if(isTaskLine(line)){
      if(!current){
        current = { id: uid("sec"), title: "Sin título", items: [] };
        sections.push(current);
      }
      const base = stripBullet(line);
      const {clean, due} = extractDue(base);
      current.items.push({
        id: uid("item"),
        text: clean,
        due,
        done: false
      });
    } else if(isSectionLine(line)){
      // Create new section
      const title = line.replace(/^\d+\.\s*/, "").trim(); // remove leading "1."
      current = { id: uid("sec"), title, items: [] };
      sections.push(current);
    }
  }
  // Remove empty sections
  return sections.filter(s => s.items.length > 0);
}

function computeProgress(){
  const all = state.sections.flatMap(s => s.items);
  const done = all.filter(i => i.done).length;
  const total = all.length;
  els.progressTxt.textContent = `${done}/${total}`;
}

function render(){
  els.list.innerHTML = "";
  const q = els.search.value.trim().toLowerCase();

  for(const sec of state.sections){
    const secMatches = sec.title.toLowerCase().includes(q);
    const itemsFiltered = sec.items.filter(it => {
      const hay = (it.text + " " + (it.due||"")).toLowerCase();
      return !q || secMatches || hay.includes(q);
    });

    if(itemsFiltered.length === 0) continue;

    const section = document.createElement("div");
    section.className = "section";

    const header = document.createElement("div");
    header.className = "sectionHeader";

    const left = document.createElement("div");
    left.innerHTML = `<div class="sectionTitle">${escapeHtml(sec.title)}</div>`;

    const right = document.createElement("div");
    const secDone = itemsFiltered.filter(i => i.done).length;
    right.innerHTML = `<span class="pill"><span>Hechas:</span> <b>${secDone}/${itemsFiltered.length}</b></span>`;

    header.appendChild(left);
    header.appendChild(right);

    const items = document.createElement("div");
    items.className = "items";

    for(const it of itemsFiltered){
      const label = document.createElement("label");
      label.className = "item" + (it.done ? " done" : "");

      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = !!it.done;
      cb.addEventListener("change", () => {
        it.done = cb.checked;
        save();
        computeProgress();
        render(); // refresh styles
      });

      const textWrap = document.createElement("div");
      textWrap.style.flex = "1";

      const topRow = document.createElement("div");
      topRow.style.display = "flex";
      topRow.style.gap = "10px";
      topRow.style.alignItems = "center";
      topRow.style.justifyContent = "space-between";

      const text = document.createElement("div");
      text.className = "text";
      text.textContent = it.text;

      topRow.appendChild(text);

      if(it.due){
        const tag = document.createElement("span");
        tag.className = "dateTag";
        tag.textContent = it.due;
        topRow.appendChild(tag);
      }

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = it.done ? "Marcada como entregada ✅" : "Pendiente ⏳";

      textWrap.appendChild(topRow);
      textWrap.appendChild(meta);

      label.appendChild(cb);
      label.appendChild(textWrap);

      items.appendChild(label);
    }

    section.appendChild(header);
    section.appendChild(items);

    els.list.appendChild(section);
  }

  computeProgress();
}

function escapeHtml(str){
  return str.replace(/[&<>"']/g, c => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[c]));
}

function generateFromTextarea(){
  const raw = els.rawInput.value || "";
  const sections = parseToSections(raw);

  state.raw = raw;
  state.sections = sections;

  save();
  render();
}

function resetAll(){
  if(!confirm("Esto borrará la lista y TODO tu progreso guardado. ¿Seguro?")) return;
  localStorage.removeItem(LS_KEY);
  state = { raw:"", sections:[] };
  els.rawInput.value = "";
  els.search.value = "";
  render();
}

function uncheckAll(){
  for(const sec of state.sections){
    for(const it of sec.items) it.done = false;
  }
  save();
  render();
}

function exportState(){
  const data = JSON.stringify(state, null, 2);
  // copy to clipboard if possible
  navigator.clipboard?.writeText(data).catch(()=>{});
  alert("Export listo ✅\n\nYa quedó copiado al portapapeles (si tu navegador lo permite).\nSi no, se descargará como archivo.");
  // download
  const blob = new Blob([data], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "checklist_export.json";
  a.click();
  URL.revokeObjectURL(a.href);
}

async function importState(){
  // Option A: paste JSON
  const pasted = prompt("Pega aquí el JSON exportado (checklist_export.json):");
  if(!pasted) return;
  try{
    const obj = JSON.parse(pasted);
    if(!obj || !Array.isArray(obj.sections)) throw new Error("Formato inválido");
    state = obj;
    els.rawInput.value = state.raw || "";
    save();
    render();
    alert("Importado ✅");
  }catch(e){
    alert("No se pudo importar. Asegúrate de pegar el JSON completo.");
  }
}

function loadExample(){
  els.rawInput.value =
`Tarea
1. INTELIGENCIA ARTIFICIAL
-Linea del tiempo (09 febrero)
-Mapa conceptual (11 de febrero)
-Presentación (09 febrero)
2. ADMINISTRACIÓN DE REDES
-Informe Técnico: Procesos administrativos y funciones administrativas de red (12 febrero)
3. HACKING ETICO
-Infografia Hacking Etico
-Ver video
4. LOGICA
-Descripción del problema a resolver con software
5. TALLER DE INVESTIGACION II
-Actividad 1 Evaluación y complementación del protocolo (11 de febrero)
6. TECNOLOGIA DE VIRTUALIZACIÓN
-Reporte y mapa (9 febrero)
7. TECNOLOGÍAS EN LA NUBE
-Actividad 1.3 Investigación y Participación (10 febrero)`;
}

function init(){
  const has = load();
  if(has){
    els.rawInput.value = state.raw || "";
  }else{
    loadExample();
    // no auto-generate until user clicks, but we can be helpful:
  }
  render();
}

els.btnGenerate.addEventListener("click", generateFromTextarea);
els.btnLoadExample.addEventListener("click", loadExample);
els.btnResetAll.addEventListener("click", resetAll);
els.search.addEventListener("input", render);
els.btnUncheckAll.addEventListener("click", uncheckAll);
els.btnExport.addEventListener("click", exportState);
els.btnImport.addEventListener("click", importState);

init();
</script>
</body>
</html>
